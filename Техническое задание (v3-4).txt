Техническое задание (v3.4)
Система оцифровки HR и Бухгалтерии сети ПВЗ
Таймзона: Asia/Almaty
Этапы: Этап 1 — HR; Этап 2 — Финансы/ПВЗ
 
0. Резюме продукта (Executive Summary)
Мы строим единую систему управления сетью ПВЗ, которая:
1.	оцифровывает кадровые процессы (приём, увольнение, перемещения, табель/график, дисциплина, мотивация),
2.	выполняет юридически значимые подписи через eGov API (при поддержке Uchet ЭДО в переходный период),
3.	учитывает финансы ПВЗ (аренда/налоги/операционные расходы) и подтягивает показатели ПВЗ из Excel Wildberries с гибким расширением полей,
4.	даёт руководству дашборды по удержанию, текучке и прибыльности.
 
1. Бизнес-цели и KPI
•	Удержание сотрудников > 6 месяцев: +20% в течение года.
•	Время обработки заявки HR: ≤ 2 рабочих дней (p95).
•	100% кадровых документов — онлайн-подписание (eGov API; Uchet — как fallback/переход).
•	Точный табель/график (зарплата по сменам, 1 сотрудник = 1 смена/день).
•	Финансовая прозрачность на уровне ПВЗ/филиалов/городов.
•	Быстрый импорт Excel из Wildberries, поддержка новых показателей без доработки кода.
 
2. Стейкхолдеры и роли
•	Администратор — глобальные настройки, роли/права, интеграции, справочники.
•	HR — приём/увольнение/приказы/eGov-подпись, мотивация, аналитика, юридические чек-листы (enbek.kz, Wildberries).
•	РФ (руководитель филиала) — заявки на приём, график/табель, временные и постоянные переводы, дисциплина, опер.расходы (этап 2).
•	РР (руководитель РФ) — подтверждение действий РФ (дисциплина, карточки новых ПВЗ, опер.расходы), контроль филиала.
•	Бухгалтер (этап 2) — аренда/налоги, операционные расходы, импорт показателей, отчёты.
•	Руководство — дашборды (HR + финансы), аудиты соблюдения процедур.
•	Сотрудник — без доступа (этап 1); в будущем — ЛК с документами/графиком/KPI.
Идентификатор сотрудника: ИИН (для истории повторных наймов, ЭЦП и линкующих операций).
 
3. Глоссарий и ключевые допущения
•	ПВЗ — пункт выдачи заказов; на каждой точке два менеджера (A и B).
•	Основной ПВЗ — ПВЗ, к которому сотрудник юридически привязан по договору.
•	Временное перемещение — на даты; после окончания — автовозврат.
•	Постоянный перевод — изменение основного ПВЗ + автогенерация приказа о перемещении.
•	eGov API — канал онлайн-подписания документов (договоры/приказы).
•	Uchet ЭДО — текущий канал подписания; поддерживается в переходный период.
•	enbek.kz (ЕСУТД) — реестр сведений о трудовых договорах (HR фиксирует факт внесения/прекращения).
•	Wildberries OS — внешняя операционная система; HR вручную заводит/удаляет доступ сотрудника; факт фиксируется чек-листом.
 
4. Этап 1 — HR
4.1. Личный кабинет сотрудника (внутренний профиль)
Статусы: candidate → approved_by_hr → active → terminated.
Активация только после подтверждения HR и готовности пакета документов.
Досье содержит:
•	Персональные данные (ФИО, ИИН, дата рождения, контакты, адрес).
•	Трудовые (должность, филиал/город, основной ПВЗ, ставка, дата начала, испытательный срок, руководитель РФ).
•	Документы (договоры, приказы, предупреждения, объяснительные; статусы подписи).
•	История перемещений (временные/постоянные).
•	Стаж/мотивация.
•	Табель/график (свод за периоды).
Валидации: уникальный ИИН, обязательные поля; при active — наличие подписанного договора.
 
4.2. Электронный документооборот (ЭДО)
Текущее: Uchet ЭДО по e-mail (поддержка).
Цель: прямая интеграция с eGov API: инициирование, подписание, проверка, регистрация, статусы (sent/signed/rejected/archived), таймстемпы.
Автогенерация документов:
•	Трудовой договор (с пунктом о праве временного перемещения в пределах города).
•	Приказы: о приёме, отпуске, увольнении, дисципл. взыскании, командировке, о постоянном переводе.
•	Шаблоны с автозаполнением (ФИО, ИИН, должность, филиал, основной ПВЗ, ставка, дата начала, испытательный срок, руководитель, реквизиты работодателя).
Аудит: кто/что/когда отправил/подписал, версия шаблона, ID в eGov.
 
4.3. Приём (Approval Path)
1.	РФ создаёт заявку (контактные данные, ИИН, должность, филиал, планируемый ПВЗ, ставка, документы).
2.	HR проверяет законность/комплектность → approve.
3.	Система генерирует договор/приказ о приёме → eGov-подпись (работодатель/работник).
4.	Юридический чек-лист HR (обязателен к закрытию):
o	внесение сведений в enbek.kz (ЕСУТД): № записи/дата/скан подтверждения;
o	завод учётки в Wildberries OS: логин/ID, дата/время.
5.	После закрытия чек-листа → статус active, кабинет активирован.
6.	Уведомления: РФ (статус), Руководство (еженедельная аналитика заявок).
SLA: HR ≤ 2 рабочих дней (p95).
 
4.4. Увольнение (Approval Path)
1.	РФ инициирует, указывает причину.
2.	HR проверяет, генерирует приказ → eGov-подпись.
3.	Юридический чек-лист HR:
o	прекращение в enbek.kz (№ записи/дата/скан),
o	удаление доступа в Wildberries OS (дата/время/кем).
4.	Статус сотрудника → terminated, кабинет деактивирован.
5.	Уведомления: РФ, Руководство (ежемесячный отчёт по причинам).
 
4.5. Переводы между ПВЗ (временный/постоянный)
Тип 1 — Временный:
•	Инициатор: РФ; даты start/end; причина.
•	После end — автовозврат на основной ПВЗ.
•	Уведомления: HR.
•	Учёт в табеле: смены по новому ПВЗ; дубли исключены (см. валидации графика).
Тип 2 — Постоянный (перевод):
•	Инициатор: РФ; тип = “постоянный”; дата перевода.
•	HR подтверждает → карточка сотрудника обновляет основной ПВЗ;
•	Автогенерация приказа о перемещении → eGov-подпись;
•	Сотрудник исключается из планирования старого ПВЗ, добавляется в новый;
•	Уведомления: оба РФ + HR + Руководство (дашборд кадровых изменений).
Валидации: при пересечении с уже назначенными сменами — диалог переноса/отмены; без подписанного приказа постоянный перевод не активируется.
 
4.6. Дисциплина: предупреждения/объяснительные
•	Сценарий 1: РФ инициирует → РР подтверждает → HR фиксирует → сотрудник получает через ЭДО.
•	Сценарий 2: РР требует объяснительную → РФ обязан инициировать → HR фиксирует.
•	Сценарий 3: РФ пишет объяснительную сам на себя → HR фиксирует → РР уведомляется.
•	В аналитике руководства — динамика по филиалам/ПВЗ.
 
4.7. Мотивация по стажу
•	Дефолтная шкала (редактируемая): 6 мес — 15 000, 1 год — 20 000, 2 года — 50 000, 3 года — 100 000 KZT.
•	Система рассчитывает наступление премий; HR подтверждает; уведомления РФ/Руководству.
•	Стаж учитывает перерывы/повторные приёмы (по ИИН).
 
4.8. Табель и график смен (ядро расчёта зарплаты)
Модель ПВЗ: 2 менеджера (A и B).
Правило жёсткое: 1 сотрудник = 1 смена в день (никаких дублей).
Автогенерация графика (ежемесячно):
•	Делим месяц на 2 части: ceil(days/2) и floor(days/2).
•	A покрывает первую половину, B — вторую (или наоборот — опция «чётность месяца»).
•	Исключения (отпуск/больничный/перевод) — локальные сдвиги в окне ±3 дня.
•	РФ видит черновик, может drag&drop корректировать, затем подтверждает план.
Интеграция с переводами:
•	При временном переводе — дни перевода считаются на новом ПВЗ (старый ПВЗ не может планировать эти дни).
•	При постоянном переводе — сотрудник исключается из планирования старого ПВЗ с даты приказа.
Табель:
•	Автоформируется из графика; статусы: явка/отпуск/больничный/неявка/командировка.
•	Экспорт XLSX/CSV; интеграция в 1С/ERP при наличии.
•	После approve периода табель блокируется (кроме HR/Admin).
UX/валидации:
•	Подсветка конфликтов (дубли, недоступность, перевод).
•	Контроль баланса A/B (допуск ±1 день/месяц).
•	Лог правок РФ на графике.
 
4.9. HR-аналитика
•	Текучка (%), средний срок работы, доля > 6 мес, рейтинг РФ (удержание/качество заявок/скорость рассмотрения).
•	Переводы (врем./пост.), дисциплина.
•	Фильтры: период, город, филиал, ПВЗ, РФ; экспорт XLSX/CSV.
 
5. Этап 2 — Финансы и ПВЗ
5.1. Аренда/налоги (Approval Path)
•	Инициатор: Бухгалтер → Подтверждение: Фин.директор/HR → Уведомление: Руководство.
•	Карточка аренды: ID арендодателя, договор/сроки/ставки, индекс, квадратура, фото, история допсоглашений/уведомлений.
 
5.2. Операционные расходы (Approval Path)
•	Инициатор: РФ → РР подтверждает → Бухгалтер фиксирует (счёт/чек/акт).
•	Категории: ремонт/лампочки/расходники/коммунальные/уборка/прочее (редактируемый справочник).
•	Аналитика по ПВЗ/филиалам/городам; связь с HR-метриками (текучка ↔ расходы).
 
5.3. Новое ПВЗ (Approval Path)
•	РФ создаёт карточку ПВЗ (адрес/город, квадратура, фото, арендодатель/условия, дата открытия, ответственный).
•	РР подтверждает корректность.
•	Бухгалтер прикрепляет договор аренды, привязывает расходы.
•	Уведомления: Руководство (отчёт по открытиям).
 
5.4. Показатели ПВЗ из Excel (Wildberries) — гибкая схема
Цель: обеспечиваем технологию динамического расширения полей/метрик без релизов кода.
Основная идея:
•	Есть обязательные «ядровые» поля (минимум для аналитики и связки):
o	period (день или месяц), pvz_id,
o	turnover, commission, withholdings, net_total.
•	Все дополнительные столбцы в загруженном Excel автоматически попадают как динамические метрики(см. ниже).
Процесс:
1.	Пользователь выбирает файл Excel (строго утверждённого шаблона заголовков для ядра; остальные столбцы — свободны).
2.	Предпросмотр: 50 строк + подсветка ошибок (несуществующий pvz_id, неправильный формат period, типы/валюта, дубли (pvz_id, period)).
3.	Загрузка (upsert): ядровые поля — строго в таблицу фактов; все новые незнакомые колонки → в Key-Value хранилище метрик (см. ниже).
4.	Версионирование шаблонов: сохраняем «снимок структуры» файла (какие кастомные поля пришли и как названы).
5.	Маппинг переименований (опционально): админ может «склеить» переименованные поля прошлого месяца к новой колонке (data dictionary).
Схема данных (фрагмент):
•	WB_KPI_Fact: id, pvz_id, period, turnover, commission, withholdings, net_total, source_file_id, imported_at, is_final.
•	WB_KPI_Metric: id, fact_id, metric_key, metric_value (DECIMAL/STRING), metric_type (num/text), unit (шт/₸/%).
•	WB_KPI_SchemaSnapshot: id, source_file_id, header_list_json, created_at.
•	WB_KPI_Dictionary: id, alias (псевдоним), canonical_key, active.
Отчёты/дашборды:
•	Отчёты могут использовать ядровые поля + выбранные динамические метрики.
•	Конструктор: чек-боксы динамических метрик (только числовые — в графики; текстовые — в таблицы).
•	Фильтры: период/ПВЗ/город/филиал; срезы день/неделя/месяц/квартал.
Правила:
•	Данные «закрытого» периода — read-only (кроме Админа).
•	Вся валюта — KZT (формат: 1 234 567,89 ₸).
•	Логи: кто загрузил, сколько строк, сколько отклонено и почему.
 
6. UX-наброски ключевых экранов
•	Панель РФ: список сотрудников филиала, календарь графика (две дорожки A/B), кнопка «Сгенерировать», режим правок drag&drop, создание перемещений (врем./пост.), дисциплина.
•	Панель HR: заявки, реестр документов/подписей eGov, шаблоны, юридические чек-листы (enbek.kz, Wildberries), табель, аналитика.
•	Панель Бухгалтера: аренда/налоги, расходы, импорт Excel, отчёты.
•	Панель РР: подтверждения (дисциплина, карточки ПВЗ, расходы), мониторинг филиала.
•	Панель Руководства: сводные дашборды HR/финансы, соблюдение юридических процедур.
 
7. Правила доступа (RBAC)
•	РФ — в пределах своего филиала/ПВЗ.
•	РР — все ПВЗ филиала.
•	HR — вся сеть.
•	Бухгалтер — финансовые сущности (плюс чтение HR-срезов для связки).
•	Руководство — агрегаты/дашборды.
•	Админ — всё + конфиг/интеграции.
 
8. Интеграции
•	eGov API — подписание/проверка/статусы/ID; ретраи при сбое; журнал ошибок.
•	Uchet ЭДО — поддержка в переходный период (чтение статусов/ID).
•	Wildberries OS — ручные операции HR (создать/удалить доступ); обязательная фиксация в чек-листах.
•	enbek.kz (ЕСУТД) — ручной учёт HR (внесение/прекращение договора); фиксация в чек-листах.
•	Email/Telegram — уведомления (входящие задания, статусы, напоминания).
•	Excel/ERP (1С) — выгрузки табеля/отчётов.
 
9. Нефункциональные требования
•	Производительность: p95 API ≤ 400 мс (без внешних вызовов).
•	Масштаб: 76 ПВЗ; 500–2 000 сотрудников; импорт Excel до 100К строк/загрузку (≤ 60 сек).
•	Доступность: 99,5%+.
•	Безопасность: HTTPS, шифрование хранения документов, журнал аудита, DLP для ИИН.
•	Бэкапы: RPO ≤ 24 ч, RTO ≤ 4 ч.
 
10. Схема данных (сокращённо)
HR/Орг:
•	Employee*(id, iin, fio, dob, contacts, status, hire_date, termination_date, position_id, branch_id, main_pvz_id, manager_rf_id, wage_type, probation_until)
•	PVZ*(id, code, address, city_id, branch_id, area_sqm, landlord_id?, is_active)
•	Transfer*(id, employee_id, type:temporary|permanent, from_pvz_id, to_pvz_id, start_date, end_date?, reason, initiated_by_rf_id, order_doc_id?, created_at)
•	Document*(id, employee_id, type, template_id, payload_json, status, provider:egov|uchet, provider_doc_id, signed_at)
•	ShiftPlan*(id, month, pvz_id, created_by_rf_id)
•	ShiftAssignment*(id, shift_plan_id, employee_id, pvz_id, date, t_start, t_end, status, transfer_flag)
•	Timesheet*(id, employee_id, month, shifts, hours, status:open|approved|locked)
Финансы (этап 2):
•	Landlord*, LeaseContract*, ExpenseCategory*, Expense*, WB_KPI_Fact*, WB_KPI_Metric*, WB_KPI_SchemaSnapshot*, WB_KPI_Dictionary*
Инфраструктура: User*, Role*, UserRole, Notification, AuditLog, FileAttachment*, Template*
 
11. API (высокоуровневое)
HR:
•	POST /hiring-requests (RF) → POST /hiring-requests/{id}/review (HR)
•	POST /employees/{id}/documents (генерация договора/приказа)
•	POST /documents/{id}/send-signature (eGov) → GET /documents/{id}/status
•	POST /terminations (RF) → POST /terminations/{id}/approve (HR)
•	POST /transfers (RF: type=temporary|permanent) → при permanent возвращает и order_doc_id (после подписания)
•	GET /analytics/hr (фильтры)
Табель/график:
•	POST /shift-plans (RF) → POST /shift-plans/{id}/autogenerate (A/B)
•	POST /shift-plans/{id}/assignments (bulk) → PUT /shift-assignments/{id}
•	POST /timesheets/{employee}/{YYYY-MM}/approve
Финансы/ПВЗ:
•	POST /landlords / POST /lease-contracts
•	POST /expenses (RF) → POST /expenses/{id}/approve (RR) → POST /expenses/{id}/book (Accountant)
•	POST /wb-kpi/import (Excel) → GET /wb-kpi/metrics (выбор динамических метрик)
•	GET /analytics/finance
Ошибки/валидации: 422 (валидация), 403 (права), 409 (конфликт — дубль смены и т.п.), 5xx (интеграции).
 
12. Уведомления
•	РФ: статусы заявок, конфликты графика, напоминания о подтверждении плана.
•	HR: новые заявки/подписи/увольнения/переводы, напоминания по чек-листам (enbek.kz, Wildberries).
•	РР: подтверждение дисциплины/расходов/карточек ПВЗ.
•	Бухгалтер: расходы на согласовании, индексации аренды, результаты импортов Excel.
•	Руководство: недельные/месячные сводки HR/финансы.
 
13. Миграция/переход
•	Импорт текущих сотрудников/ПВЗ из Excel (валидации ИИН/дубликатов/пустых ПВЗ).
•	Двойной контур подписания: Uchet + eGov (по флагу) на переходе.
•	Тестовый стенд для HR/RF; обучающие сценарии.
 
14. Критерии приёмки
Этап 1:
1.	Приём: РФ заявка → HR approve → договор/приказ (eGov) → чек-лист HR (enbek.kz + Wildberries) → active→ уведомления.
2.	Увольнение: причина РФ → приказ (eGov) → чек-лист HR (enbek.kz + удаление доступа Wildberries) → terminated.
3.	Переводы:
o	временный — учёт смен в новом ПВЗ + автовозврат;
o	постоянный — обновлён основной ПВЗ + приказ о перемещении (eGov).
4.	Табель/график: автогенерация A/B без дублей; валидация «1 сотрудник = 1 смена/день»; approve блокирует задние правки.
5.	Аналитика HR — корректные цифры, фильтры и выгрузки работают.
Этап 2:
1.	Аренда/налоги — карточки и документы, отчёты по периодам.
2.	Опер.расходы — РФ→РР→Бухгалтер, аналитика.
3.	Новое ПВЗ — РФ→РР→Бухгалтер, уведомления руководству.
4.	Импорт Excel (WB): ядро + любые новые поля → в отчётах доступны как динамические метрики; логи/ошибки/версии.
 
15. План реализации (MVP-декомпозиция)
Спринт 1–2 (HR ядро):
•	Заявки на приём, eGov прототип, шаблоны, юридические чек-листы, базовый профиль сотрудника.
Спринт 3 (График/табель):
•	Автогенерация A/B, календарь РФ, интеграция с переводами, табель и approve.
Спринт 4 (Переводы/дисциплина/мотивация):
•	Временный/постоянный перевод (с приказом), дисциплина, мотивация, дашборды HR.
Спринт 5 (Импорт WB KPI):
•	Импорт Excel с динамическими полями, словарь метрик, отчёты.
Спринт 6 (Финансы старт):
•	Карточки аренды, опер. расходы (цепочка РФ→РР→Бухгалтер), базовые фин.дашборды.

